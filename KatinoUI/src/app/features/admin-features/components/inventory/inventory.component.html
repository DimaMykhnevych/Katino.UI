<div class="main container-fluid p-3">
  <div class="table-header">
    <div class="header-content">
      <div class="header-info">
        <h2 class="table-title">
          <mat-icon class="title-icon">inventory</mat-icon>
          Наявність
        </h2>
      </div>
    </div>

    <div class="table-controls">
      <mat-form-field class="search-field" appearance="outline">
        <mat-label>Пошук товарів ...</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Назва товару"
        />
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>
  </div>
  <div class="mat-elevation-z8 table-wrapper">
    <table mat-table matSort [dataSource]="dataSource" class="variants-table">
      <ng-container matColumnDef="product">
        <th
          mat-header-cell
          *matHeaderCellDef
          mat-sort-header
          class="text-center"
        >
          Товар
        </th>
        <td mat-cell *matCellDef="let variant">
          <div class="color-size-cell">
            <div>
              <span class="product-name">{{ variant.product.name }}</span>
            </div>
            <div class="color-size-cell-content">
              <div class="color-info">
                <div
                  class="color-swatch"
                  [style.background-color]="variant.color.hexCode"
                  [matTooltip]="variant.color.name"
                ></div>
              </div>
              <div class="size-info">
                <span
                  class="size-badge"
                  [class.letter-size]="variant.size.type === 1"
                >
                  {{ variant.size.name }}
                </span>
              </div>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="productPhoto">
        <th mat-header-cell *matHeaderCellDef class="text-center">Фото</th>
        <td
          mat-cell
          *matCellDef="let variant"
          [class.remove-bottom-border]="!variant.isLastInGroup"
        >
          <img
            src="https://t3.ftcdn.net/jpg/04/83/25/50/360_F_483255019_m1r1ujM8EOkr8PamCHF85tQ0rHG3Fiqz.jpg"
            width="100"
            height="100"
            *ngIf="variant.showProductInfo"
          />
        </td>
      </ng-container>

      <ng-container matColumnDef="article">
        <th class="article" mat-header-cell *matHeaderCellDef>Артикул</th>
        <td
          class="article"
          mat-cell
          *matCellDef="let variant"
          [class.remove-bottom-border]="!variant.isLastInGroup"
        >
          <div class="article-cell" *ngIf="variant.showProductInfo">
            <span class="article-code">{{ variant.product.article }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="availability">
        <th mat-header-cell *matHeaderCellDef class="text-center">Наявність</th>
        <td mat-cell *matCellDef="let variant">
          <div>
            <span>{{
              variant.quantityInStock -
                variant.quantityDropSold -
                variant.quantityRegularSold
            }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="productStatus">
        <th mat-header-cell *matHeaderCellDef class="text-center">Статус</th>
        <td mat-cell *matCellDef="let variant">
          <div>
            <span [class]="getProductStatusClass(variant.status)">{{
              getProductStatusDisplayName(variant.status)
            }}</span>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="measurements">
        <th mat-header-cell *matHeaderCellDef class="text-center">Заміри</th>
        <td mat-cell *matCellDef="let variant">
          <div class="measurements-cell">
            <div
              class="measurement-item"
              *ngFor="let measurement of variant.measurements"
            >
              <span class="measurement-name"
                >{{ measurement.measurementType.name }}:</span
              >
              <span class="measurement-value"
                >{{ measurement.value }}
                {{ measurement.measurementType.unit }}</span
              >
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="text-center">Дії</th>
        <td mat-cell *matCellDef="let variant">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item>
              <mat-icon>info</mat-icon>
              <span>Інфо</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="variant-row"
      ></tr>
    </table>

    <div *ngIf="isRetrievingProductVariants">
      <app-spinner [diameter]="50"></app-spinner>
    </div>

    <mat-paginator [pageSizeOptions]="[5, 10, 20, 1000]" showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
